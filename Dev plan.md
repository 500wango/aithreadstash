### **AI ThreadStash V1.1 "Pro" - 详细开发计划 (V1.3 生产环境就绪版)**

**总览：** 此计划已全面整合DevOps和安全最佳实践，将开发周期扩展至6周。目标是构建一个功能完整、高度可靠、运维体系健全的商业级产品。

#### **第一周：地基与自动化 (Foundation \& Automation)**

* **周目标:** 完成项目初始化，搭建安全可配置的本地环境，并建立CI/CD自动化流程。
* **任务列表:**

  * \[ ] **环境:** 在本地操作系统上安装并配置好Node.js和PostgreSQL。
  * \[ ] **后端:**

    * **(决策)** 确定后端框架：**NestJS** (推荐，因其架构规范，利于长期维护) 。
    * \[ ] 初始化后端项目，集成 dotenv 管理环境变量。
    * \[ ] 编写数据库迁移脚本，配置连接池和关键字段索引。
    * \[ ] 实现基础的邮箱/密码注册登录API。

  * \[ ] **前端 (网站):**

    * \[ ] 初始化Next.js项目，完成静态页面UI（含年度订阅折扣）。

  * \[ ] **(新增) DevOps \& 文档:**

    * \[ ] **建立CI/CD流水线:** 配置GitHub Actions，在每次代码推送时自动运行Linter和单元测试。
    * \[ ] **生成API文档:** 集成Swagger (OpenAPI)，在开发过程中自动生成并更新API文档。

#### **第二周：安全认证体系 (Secure Authentication)**

* **周目标:** 实现一个安全、完整的用户认证流程，并覆盖全面的测试用例。
* **任务列表:**

  * \[ ] **后端:**

    * \[ ] **(增强)** 实现包含Access Token和Refresh Token的JWT安全机制。
    * \[ ] 集成Google和GitHub OAuth 2.0登录。
    * \[ ] 完善 /api/user/me 端点。

  * \[ ] **前端 (网站 \& 插件):**

    * \[ ] 开发包含所有登录选项的UI组件。
    * \[ ] 对接后端API，实现完整的登录、注册、登出及Token刷新逻辑。
    * \[ ] 开发基础的用户中心(Dashboard) UI。

  * \[ ] **(增强) 测试:**

    * \[ ] **编写详细的测试用例:** 覆盖所有认证流程（邮箱/密码、Google、GitHub、Token刷新、错误处理）的单元测试和集成测试。

#### **第三周：健壮的核心功能 (Robust Core Feature)**

* **周目标:** 完成一个健壮、安全、有弹性的Notion集成流程。
* **任务列表:**

  * \[ ] **后端:**

    * \[ ] 完成Notion OAuth 2.0的后端授权流程。
    * \[ ] **(增强)** 对数据库中的Notion access\_token进行强加密存储（如使用AES-256）。
    * \[ ] **(增强)** 在/api/notion/save逻辑中，实现健壮的错误处理和降级方案（当Notion API不可用时，向用户返回清晰提示），并加入请求重试机制。

  * \[ ] **前端 (插件):**

    * \[ ] 开发完整的Notion连接和数据库选择UI。
    * \[ ] 实现“导出到Notion”的功能，并处理后端返回的各种状态（成功、失败、API不可用等）。

  * \[ ] **(增强) 测试:**

    * \[ ] **编写模拟测试:** 模拟Notion API的成功、失败和速率限制场景，测试后端的容错和重试逻辑。

#### **第四周：可靠的商业化 (Reliable Monetization)**

* **周目标:** 完成支付流程的开发，并确保其在各种异常情况下的可靠性。
* **任务列表:**

  * \[ ] **后端:**

    * \[ ] 开发Stripe Checkout和客户门户的API端点。
    * \[ ] 开发并用Stripe CLI在本地测试Webhook端点，确保其幂等性（即重复接收同一事件不会产生副作用）。

  * \[ ] **前端 (网站):**

    * \[ ] 完成定价页与Stripe Checkout的对接。
    * \[ ] 完成用户中心与Stripe客户门户的对接。

  * \[ ] **(增强) 测试:**

    * \[ ] **编写完整的支付流程测试用例:** 覆盖订阅成功、失败、取消以及Webhook处理的各种边界情况。

#### **第五周：发布准备与数据迁移 (Launch Prep \& Data Migration)**

* **周目标:** 集成所有功能，完成端到端测试，并为老用户提供平滑的过渡方案。
* **任务列表:**

  * \[ ] **前端 (插件):**

    * \[ ] 开发页面注入按钮（In-Page UI）功能。
    * \[ ] **(新增)** 开发一个简单的功能，允许MVP版本的用户将其本地设置（如偏好格式）导入到他们的新账户中。

  * \[ ] **全平台:**

    * \[ ] 进行完整的用户流程端到端测试，并进行Edge浏览器的兼容性测试。
    * \[ ] 修复所有已知Bug，优化性能和UI。
    * \[ ] **部署：** 将后端和网站部署到线上平台。
    * \[ ] **发布：** 提交插件新版本至Chrome网上应用店。

#### **第六周 (新增)：生产环境强化与运维 (Production Hardening \& Operations)**

* **周目标:** 在产品发布后，立即建立起一套完整的监控、备份和运维体系，确保线上服务的长期稳定。
* **任务列表:**

  * \[ ] **监控与日志:**

    * \[ ] **集成Sentry** 或类似工具，进行实时的前端和后端错误追踪与报警。
    * \[ ] 配置应用性能监控(APM)和服务器健康检查。

  * \[ ] **数据库运维:**

    * \[ ] **配置生产环境数据库的每日自动备份**。
    * \[ ] **执行并文档化一次完整的数据库恢复演练**，确保备份有效。

  * \[ ] **文档与流程:**

    * \[ ] 最终确定并发布API文档。
    * \[ ] **编写基础的部署文档和运维手册**。

\[ ] **建立一个简单的故障处理流程文档 (Playbook)**。

